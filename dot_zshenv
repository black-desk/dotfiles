#!/bin/env bash

export LANG=zh_CN.UTF-8
export LANGUAGE=zh_CN:en_US

fcitx5 --keep -d >/dev/null 2>&1

export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.socket"

export VISUAL=nvim
export EDITOR=nvim
export PAGER="less -r"

export HISTFILE="$HOME/.zsh_history"
export SAVEHIST=100000
export HISTSIZE=100000

# CMAKE

export CC=clang
export CXX=clang++
export CMAKE_C_COMPILER=$CC
export CMAKE_CXX_COMPILER=$CXX
export CMAKE_GENERATOR=Ninja
export CMAKE_EXPORT_COMPILE_COMMANDS=1
export CMAKE_C_FLAGS="-Wno-unused-command-line-argument"
export CMAKE_CXX_FLAGS="-Wno-unused-command-line-argument"

function update_path() {
        local dir=$1
        local append=$2
        if [[ ${path[(ie)$dir]} -gt ${#path} ]]; then 
                if [[ -n $append ]]; then
                        path+=($dir)
                else
                        path=($dir $path)
                fi
        fi
}

update_path "$HOME/.local/bin"
update_path "/sbin" append
update_path "/bin" append
update_path "/usr/sbin" append
update_path "/usr/bin" append
update_path "/usr/local/sbin" append
update_path "/usr/local/bin" append

# GOENV

export GOENV_ROOT="$HOME/.goenv"
export GOENV_HOOK_PATH="$HOME/.local/lib/goenv_hook/"
export GOENV_APPEND_GOPATH=
export GOENV_PREPEND_GOPATH=1
export GOPATH="$HOME/Documents/go"
export GOENV_GOPATH_PREFIX="$GOPATH"

update_path "$GOENV_ROOT/bin"
update_path "$GOENV_ROOT/shims"

goenv(){
        unset -f goenv
        eval "$(goenv init -)"
}

update_path "$(go env GOBIN)"

# pyenv

export PYENV_ROOT="$HOME/.pyenv"

update_path "$PYENV_ROOT/bin"
update_path "$PYENV_ROOT/shims"

pyenv(){
        unset -f pyenv
        eval "$(pyenv init -)"
        pyenv $@
}

python --help &> /dev/null || (
        pyenv install anaconda3
        pyenv global anaconda3
)

# n

export N_PREFIX="$HOME/.n"

update_path "$N_PREFIX/bin"

[ -s "$N_PREFIX/bin/n" ] || (
        echo "Setting up n" &&
        curl -L https://bit.ly/n-install | N_PREFIX=~/.n bash /dev/stdin -n -y
)

# ghcup
update_path "$HOME/.ghcup/bin"

# rustup

. "$HOME/.cargo/env"

unset update_path

