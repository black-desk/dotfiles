-- https://github.com/tpope/vim-fugitive

-- Description:
-- git setup

local function config()
  local map = vim.api.nvim_set_keymap
  local opts = { noremap = true, silent = true }

  vim.g.fugitive_gitea_domains = {
    'https://{{ .gitea }}',
    'https://gitea.io',
  }
  vim.g.fugitive_gitlab_domains = {
    'https://salsa.debian.org',
    'https://whgitlab.uniontech.com',
  }

  require('gitsigns').setup({
    current_line_blame = true,
    current_line_blame_opts = {
      virt_text = true,
      virt_text_pos = 'eol', -- 'eol' | 'overlay' | 'right_align'
      delay = 300,
      ignore_whitespace = false,
    },
    keymaps = {},
  })
  map('n', '<space>gw', '<cmd>Gitsigns toggle_word_diff<cr>', opts)
  map('n', '<space>gj', '<cmd>Gitsigns next_hunk<cr>', opts)
  map('n', '<space>gk', '<cmd>Gitsigns prev_hunk<cr>', opts)
  map('n', '<space>gu', '<cmd>Gitsigns undo_stage_hunk<cr>', opts)
  map('n', '<space>gs', '<cmd>Gitsigns stage_hunk<cr>', opts)

end

return {
  'tpope/vim-fugitive',
  requires = {
    -- GBrowser handlers
    {
      -- https://github.com/tpope/vim-rhubarb
      'tpope/vim-rhubarb', -- github
      -- https://github.com/borissov/fugitive-gitea
      'borissov/fugitive-gitea', -- gitea
      -- https://github.com/shumphrey/fugitive-gitlab.vim
      'shumphrey/fugitive-gitlab.vim', -- gitlab
    },
    {
      -- https://github.com/lewis6991/gitsigns.nvim
      'lewis6991/gitsigns.nvim', -- sign column diff mark
      requires = {
        'nvim-lua/plenary.nvim',
      },
    },
  },
  config = config,
}
