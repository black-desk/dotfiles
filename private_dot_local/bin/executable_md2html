#!/usr/bin/env bash

# convert md to html using github's css

function get_title() {
        if [[ $1 = *index.md ]] ; then
                TITLE=(--metadata title="$(echo "$(basename "$(dirname "$(realpath "$1")")")" | tr "_" " ")")
        else
                TITLE="$(echo "$(basename "$1")" | tr "_" " ")"
                TITLE=(--metadata title="${TITLE%.md}")
        fi
}

get_title "$1"

pandoc -f markdown+east_asian_line_breaks+gfm_auto_identifiers+task_lists \
        --toc --toc-depth=4 --standalone --reference-links -t html \
        --include-in-header="$HOME/.local/share/md2html/pangu.html" \
        --lua-filter="$HOME/.local/share/md2html/filter.lua" \
        "$1" "${TITLE[@]}" -o "${1%.md}.html"
